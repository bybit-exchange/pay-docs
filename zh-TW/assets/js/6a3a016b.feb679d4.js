"use strict";(self.webpackChunkdocusaurus_docs=self.webpackChunkdocusaurus_docs||[]).push([[3935],{3905:(t,e,a)=>{a.d(e,{Zo:()=>p,kt:()=>u});var n=a(67294);function r(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function l(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function i(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?l(Object(a),!0).forEach((function(e){r(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function d(t,e){if(null==t)return{};var a,n,r=function(t,e){if(null==t)return{};var a,n,r={},l=Object.keys(t);for(n=0;n<l.length;n++)a=l[n],e.indexOf(a)>=0||(r[a]=t[a]);return r}(t,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(n=0;n<l.length;n++)a=l[n],e.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(t,a)&&(r[a]=t[a])}return r}var m=n.createContext({}),o=function(t){var e=n.useContext(m),a=e;return t&&(a="function"==typeof t?t(e):i(i({},e),t)),a},p=function(t){var e=o(t.components);return n.createElement(m.Provider,{value:e},t.children)},s={inlineCode:"code",wrapper:function(t){var e=t.children;return n.createElement(n.Fragment,{},e)}},k=n.forwardRef((function(t,e){var a=t.components,r=t.mdxType,l=t.originalType,m=t.parentName,p=d(t,["components","mdxType","originalType","parentName"]),k=o(a),u=r,N=k["".concat(m,".").concat(u)]||k[u]||s[u]||l;return a?n.createElement(N,i(i({ref:e},p),{},{components:a})):n.createElement(N,i({ref:e},p))}));function u(t,e){var a=arguments,r=e&&e.mdxType;if("string"==typeof t||r){var l=a.length,i=new Array(l);i[0]=k;var d={};for(var m in e)hasOwnProperty.call(e,m)&&(d[m]=e[m]);d.originalType=t,d.mdxType="string"==typeof t?t:r,i[1]=d;for(var o=2;o<l;o++)i[o]=a[o];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}k.displayName="MDXCreateElement"},61552:(t,e,a)=>{a.r(e),a.d(e,{assets:()=>m,contentTitle:()=>i,default:()=>s,frontMatter:()=>l,metadata:()=>d,toc:()=>o});var n=a(87462),r=(a(67294),a(3905));const l={title:"Common Specifications",sidebar_label:"Specifications",sidebar_position:1},i=void 0,d={unversionedId:"recurring-payments/specifications",id:"recurring-payments/specifications",title:"Common Specifications",description:"Common Request Headers",source:"@site/docs/recurring-payments/specifications.mdx",sourceDirName:"recurring-payments",slug:"/recurring-payments/specifications",permalink:"/pay-docs/zh-TW/recurring-payments/specifications",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"Common Specifications",sidebar_label:"Specifications",sidebar_position:1},sidebar:"bbyPaySideBar",previous:{title:"Introduction",permalink:"/pay-docs/zh-TW/recurring-payments/introduction"},next:{title:"Sign Request",permalink:"/pay-docs/zh-TW/recurring-payments/sign-request"}},m={},o=[{value:"Common Request Headers",id:"common-request-headers",level:2},{value:"Common Response Format",id:"common-response-format",level:2},{value:"Success Response",id:"success-response",level:3},{value:"Failure Response",id:"failure-response",level:3},{value:"Response Fields",id:"response-fields",level:3},{value:"HTTP Status Codes",id:"http-status-codes",level:2},{value:"Field Length Limits",id:"field-length-limits",level:2},{value:"Idempotency",id:"idempotency",level:2},{value:"API Timeout Recommendations",id:"api-timeout-recommendations",level:2},{value:"Concurrency Handling",id:"concurrency-handling",level:2},{value:"Same Agreement Concurrent Deductions",id:"same-agreement-concurrent-deductions",level:3},{value:"Same Order Repeated Requests",id:"same-order-repeated-requests",level:3},{value:"Transaction Status Flow",id:"transaction-status-flow",level:2},{value:"Deduction Status",id:"deduction-status",level:3},{value:"Refund Status",id:"refund-status",level:3},{value:"Rate Limiting",id:"rate-limiting",level:2},{value:"Rate Limit Strategy",id:"rate-limit-strategy",level:3},{value:"Rate Limit Response",id:"rate-limit-response",level:3},{value:"Handling Recommendations",id:"handling-recommendations",level:3}],p={toc:o};function s(t){let{components:e,...a}=t;return(0,r.kt)("wrapper",(0,n.Z)({},p,a,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"common-request-headers"},"Common Request Headers"),(0,r.kt)("p",null,"All API requests must include the following headers:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Parameter"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Type"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Required"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Content-Type"),(0,r.kt)("td",{parentName:"tr",align:"left"},"string"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"application/json"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"X-Request-Id"),(0,r.kt)("td",{parentName:"tr",align:"left"},"string"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Request unique identifier (UUID format)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"X-Timestamp"),(0,r.kt)("td",{parentName:"tr",align:"left"},"string"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Request timestamp (millisecond Unix timestamp)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"X-Signature"),(0,r.kt)("td",{parentName:"tr",align:"left"},"string"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Request signature (see ",(0,r.kt)("a",{parentName:"td",href:"signature"},"Signature Algorithm"),")")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Authorization"),(0,r.kt)("td",{parentName:"tr",align:"left"},"string"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"Bearer {access_token}"))))),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"common-response-format"},"Common Response Format"),(0,r.kt)("h3",{id:"success-response"},"Success Response"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "code": "SUCCESS",\n  "message": "ok",\n  "data": {\n    // Business data\n  }\n}\n')),(0,r.kt)("h3",{id:"failure-response"},"Failure Response"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "code": "ERROR_CODE",\n  "message": "Error description",\n  "data": null\n}\n')),(0,r.kt)("h3",{id:"response-fields"},"Response Fields"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Parameter"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Type"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"code"),(0,r.kt)("td",{parentName:"tr",align:"left"},"string"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Response code, ",(0,r.kt)("inlineCode",{parentName:"td"},"SUCCESS")," indicates success")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"message"),(0,r.kt)("td",{parentName:"tr",align:"left"},"string"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Response message")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"data"),(0,r.kt)("td",{parentName:"tr",align:"left"},"object/null"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Response data, ",(0,r.kt)("inlineCode",{parentName:"td"},"null")," on failure")))),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"http-status-codes"},"HTTP Status Codes"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"HTTP Status"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Description"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Scenario"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"200"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Success"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Business success or failure (distinguished by ",(0,r.kt)("inlineCode",{parentName:"td"},"code"),")")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"400"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Bad Request"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Parameter format error, missing required field")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"401"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Unauthorized"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Token invalid or expired")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"403"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Forbidden"),(0,r.kt)("td",{parentName:"tr",align:"left"},"IP not in whitelist, no API permission")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"404"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Not Found"),(0,r.kt)("td",{parentName:"tr",align:"left"},"API path error")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"429"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Too Many Requests"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Rate limit triggered")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"500"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Internal Server Error"),(0,r.kt)("td",{parentName:"tr",align:"left"},"System exception, please retry")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"503"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Service Unavailable"),(0,r.kt)("td",{parentName:"tr",align:"left"},"System maintenance")))),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"field-length-limits"},"Field Length Limits"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Field Type"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Max Length"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Example Fields"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Merchant ID"),(0,r.kt)("td",{parentName:"tr",align:"left"},"32"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"merchant_id"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"User ID"),(0,r.kt)("td",{parentName:"tr",align:"left"},"64"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"user_id"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"merchant_user_id"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Agreement No"),(0,r.kt)("td",{parentName:"tr",align:"left"},"64"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"agreement_no"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"external_agreement_no"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Order No"),(0,r.kt)("td",{parentName:"tr",align:"left"},"64"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"out_trade_no"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"out_refund_no"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Trade No"),(0,r.kt)("td",{parentName:"tr",align:"left"},"64"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"trade_no"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"refund_no"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Amount"),(0,r.kt)("td",{parentName:"tr",align:"left"},"32"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"amount.total"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Currency Code"),(0,r.kt)("td",{parentName:"tr",align:"left"},"16"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"currency"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"URL"),(0,r.kt)("td",{parentName:"tr",align:"left"},"512"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"notify_url"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"return_url"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Description"),(0,r.kt)("td",{parentName:"tr",align:"left"},"256"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"order_desc"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"refund_reason"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Title"),(0,r.kt)("td",{parentName:"tr",align:"left"},"128"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"order_title"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Extra Params"),(0,r.kt)("td",{parentName:"tr",align:"left"},"2048"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"extra_params")," (JSON string)")))),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"idempotency"},"Idempotency"),(0,r.kt)("p",null,"Idempotency is guaranteed through business unique indexes:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Business Scenario"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Idempotency Key"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Unique Index"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Sign Request"),(0,r.kt)("td",{parentName:"tr",align:"left"},"external_agreement_no"),(0,r.kt)("td",{parentName:"tr",align:"left"},"(merchant_id, external_agreement_no)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Deduction Order"),(0,r.kt)("td",{parentName:"tr",align:"left"},"out_trade_no"),(0,r.kt)("td",{parentName:"tr",align:"left"},"(merchant_id, out_trade_no)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Refund Request"),(0,r.kt)("td",{parentName:"tr",align:"left"},"out_refund_no"),(0,r.kt)("td",{parentName:"tr",align:"left"},"(merchant_id, out_refund_no)")))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Notes:")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"X-Request-Id")," is used for request tracing and troubleshooting"),(0,r.kt)("li",{parentName:"ul"},"Format requirement: UUID v4, e.g., ",(0,r.kt)("inlineCode",{parentName:"li"},"550e8400-e29b-41d4-a716-446655440000")),(0,r.kt)("li",{parentName:"ul"},"Repeated requests with the same merchant order number return the result of the first request")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"api-timeout-recommendations"},"API Timeout Recommendations"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"API"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Recommended Timeout"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Sign Request"),(0,r.kt)("td",{parentName:"tr",align:"left"},"10 seconds"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Sync return sign link")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Sign Confirmation"),(0,r.kt)("td",{parentName:"tr",align:"left"},"10 seconds"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Sync return sign status")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Unsign"),(0,r.kt)("td",{parentName:"tr",align:"left"},"10 seconds"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Sync return unsign result")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Agreement Deduction"),(0,r.kt)("td",{parentName:"tr",align:"left"},"30 seconds"),(0,r.kt)("td",{parentName:"tr",align:"left"},"May involve on-chain operations")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Deduction Refund"),(0,r.kt)("td",{parentName:"tr",align:"left"},"30 seconds"),(0,r.kt)("td",{parentName:"tr",align:"left"},"May involve on-chain operations")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Query APIs"),(0,r.kt)("td",{parentName:"tr",align:"left"},"10 seconds"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Sync return query result")))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Timeout Handling:")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"After timeout, call query API to confirm actual status"),(0,r.kt)("li",{parentName:"ul"},"Deduction/refund timeout does not mean failure"),(0,r.kt)("li",{parentName:"ul"},"Confirm final status through query or async notification")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"concurrency-handling"},"Concurrency Handling"),(0,r.kt)("h3",{id:"same-agreement-concurrent-deductions"},"Same Agreement Concurrent Deductions"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Same agreement supports concurrent deduction requests"),(0,r.kt)("li",{parentName:"ul"},"Each deduction needs different ",(0,r.kt)("inlineCode",{parentName:"li"},"out_trade_no")),(0,r.kt)("li",{parentName:"ul"},"Limit verification is real-time; concurrent requests may be rejected if exceeding quota")),(0,r.kt)("h3",{id:"same-order-repeated-requests"},"Same Order Repeated Requests"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Requests with same ",(0,r.kt)("inlineCode",{parentName:"li"},"out_trade_no")," are treated as the same transaction"),(0,r.kt)("li",{parentName:"ul"},"After first request succeeds, repeated requests return the first result (idempotent)"),(0,r.kt)("li",{parentName:"ul"},"After first request fails, use a new ",(0,r.kt)("inlineCode",{parentName:"li"},"out_trade_no")," to retry")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"transaction-status-flow"},"Transaction Status Flow"),(0,r.kt)("h3",{id:"deduction-status"},"Deduction Status"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                    \u2502  PROCESSING \u2502\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                           \u2502\n           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n           \u2502               \u2502               \u2502\n           \u25bc               \u25bc               \u25bc\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502   SUCCESS   \u2502 \u2502   FAILED    \u2502 \u2502   TIMEOUT   \u2502\n    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Status"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Description"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Follow-up Actions"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"PROCESSING"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Deduction in progress"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Wait for notification or query")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"SUCCESS"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Deduction successful"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Can initiate refund")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"FAILED"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Deduction failed"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Retry with new order number")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"TIMEOUT"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Deduction timeout"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Query to confirm, then decide")))),(0,r.kt)("h3",{id:"refund-status"},"Refund Status"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                    \u2502  PROCESSING \u2502\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                           \u2502\n                \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                \u2502                     \u2502\n                \u25bc                     \u25bc\n         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n         \u2502   SUCCESS   \u2502       \u2502   FAILED    \u2502\n         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Status"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Description"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Follow-up Actions"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"PROCESSING"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Refund in progress"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Wait for notification or query")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"SUCCESS"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Refund successful"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Funds returned to user")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"FAILED"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Refund failed"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Check reason, retry with new refund number")))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Refund Notes:")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Refund amount cannot exceed refundable amount"),(0,r.kt)("li",{parentName:"ul"},"Same transaction supports multiple partial refunds"),(0,r.kt)("li",{parentName:"ul"},"Used quota is restored after successful refund")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"rate-limiting"},"Rate Limiting"),(0,r.kt)("h3",{id:"rate-limit-strategy"},"Rate Limit Strategy"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"API Type"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Dimension"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Threshold"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Sign Request"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Merchant + User"),(0,r.kt)("td",{parentName:"tr",align:"left"},"10/minute"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Same merchant for same user")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Agreement Deduction"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Merchant"),(0,r.kt)("td",{parentName:"tr",align:"left"},"1000/second"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Merchant-level QPS")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Agreement Deduction"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Agreement"),(0,r.kt)("td",{parentName:"tr",align:"left"},"10/second"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Single agreement frequency")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Query APIs"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Merchant"),(0,r.kt)("td",{parentName:"tr",align:"left"},"5000/second"),(0,r.kt)("td",{parentName:"tr",align:"left"},"All query APIs shared")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Refund API"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Merchant"),(0,r.kt)("td",{parentName:"tr",align:"left"},"500/second"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Merchant-level refund rate")))),(0,r.kt)("h3",{id:"rate-limit-response"},"Rate Limit Response"),(0,r.kt)("p",null,"HTTP status ",(0,r.kt)("inlineCode",{parentName:"p"},"429")," with body:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "code": "RATE_LIMIT_EXCEEDED",\n  "message": "Too many requests, please try again later",\n  "data": {\n    "retry_after": 1000\n  }\n}\n')),(0,r.kt)("h3",{id:"handling-recommendations"},"Handling Recommendations"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Exponential Backoff"),": Retry with delays (1s, 2s, 4s, 8s)"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Request Merging"),": Use list query API instead of multiple single queries"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Async Processing"),": Use message queue for peak shaving in high concurrency"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Monitoring"),": Monitor 429 response ratio, adjust strategy accordingly")))}s.isMDXComponent=!0}}]);