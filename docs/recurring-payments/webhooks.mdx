---
title: Webhooks
sidebar_label: Webhooks
sidebar_position: 11
---

## Overview

Platform sends async notifications (webhooks) to merchant's configured URL when key events occur. All webhook notifications follow a unified three-part structure.

---

## Notification Structure

```json
{
  // Part 1: Common fields
  "notifyId": "NOTIFY202601070001",
  "notifyType": "AGREEMENT_STATUS",
  "notifyTime": "2026-01-07T10:30:05+08:00",
  "merchantId": "M123456789",

  // Part 2: Business data
  "data": {
    "eventType": "SIGNED",
    // Other business fields (varies by notifyType and eventType)
  },

  // Part 3: Signature
  "sign": "Base64 encoded signature",
  "signType": "RSA2"
}
```

### Common Fields

| Parameter | Type | Description |
|:----------|:-----|:------------|
| notifyId | string | Notification unique ID (for deduplication) |
| notifyType | string | Notification type category |
| notifyTime | string | Notification time (ISO8601 format: yyyy-MM-dd'T'HH:mm:ssXXX) |
| merchantId | string | Merchant ID |
| data | object | Business data |
| sign | string | Signature (Base64 encoded) |
| signType | string | Signature algorithm: `RSA2` |

### Notification Type Categories

| notifyType | Description | Applicable Scenarios |
|:-----------|:------------|:---------------------|
| `AGREEMENT_STATUS` | Agreement status notification | Sign, unsign, suspend, resume, timeout and all agreement status changes |
| `TRANSACTION_RESULT` | Transaction result notification | Deduction, refund and all transaction results |

**Description**:
- `notifyType` only indicates the category (agreement/transaction)
- Specific event type is distinguished by `data.eventType` field
- Specific result status is distinguished by `data.status` field

### Event Types (Agreement)

| eventType | Description | Corresponding notifyType |
|:----------|:------------|:-------------------------|
| `SIGNED` | Sign event | `AGREEMENT_STATUS` |
| `UNSIGNED` | Unsign event | `AGREEMENT_STATUS` |
| `SUSPENDED` | Suspend event | `AGREEMENT_STATUS` |
| `TIMEOUT` | Timeout event | `AGREEMENT_STATUS` |

### Event Types (Transaction)

| eventType | Description | Corresponding notifyType |
|:----------|:------------|:-------------------------|
| `PAY` | Deduction event | `TRANSACTION_RESULT` |
| `REFUND` | Refund event | `TRANSACTION_RESULT` |

---

## Sign Result Notification

### data Fields

| Parameter | Type | Description |
|:----------|:-----|:------------|
| agreementNo | string | Platform agreement number |
| externalAgreementNo | string | Merchant agreement number |
| agreementType | string | Sign type: `CYCLE` / `SINGLE` |
| eventType | string | Event type: `SIGNED` / `FAILED` |
| status | string | Sign status: `SIGNED` / `FAILED` |
| userId | string | Platform user ID |
| merchantUserId | string | Merchant-side user ID |
| sceneCode | string | Scene code |
| signTime | string | Sign time (on success) |
| failureReason | string | Failure reason (on failure) |

### Example (Success)

```json
{
  "notifyId": "NOTIFY202601070001",
  "notifyType": "AGREEMENT_STATUS",
  "notifyTime": "2026-01-07T10:30:05+08:00",
  "merchantId": "M123456789",
  "data": {
    "agreementNo": "AGR202601070001",
    "externalAgreementNo": "MERCHANT_AGR_001",
    "agreementType": "CYCLE",
    "eventType": "SIGNED",
    "status": "SIGNED",
    "userId": "U_123456789",
    "merchantUserId": "merchant_user_123",
    "sceneCode": "SUBSCRIPTION",
    "signTime": "2026-01-07 10:30:00"
  },
  "sign": "Base64 encoded signature",
  "signType": "RSA2"
}
```

### Example (Failure)

```json
{
  "notifyId": "NOTIFY202601070002",
  "notifyType": "AGREEMENT_STATUS",
  "notifyTime": "2026-01-07T10:35:05+08:00",
  "merchantId": "M123456789",
  "data": {
    "agreementNo": "AGR202601070002",
    "externalAgreementNo": "MERCHANT_AGR_002",
    "agreementType": "CYCLE",
    "eventType": "FAILED",
    "status": "FAILED",
    "userId": "U_123456789",
    "merchantUserId": "merchant_user_123",
    "sceneCode": "SUBSCRIPTION",
    "failureReason": "USER_AUTH_TIMEOUT"
  },
  "sign": "Base64 encoded signature",
  "signType": "RSA2"
}
```

---

## Deduction Result Notification

### data Fields

| Parameter | Type | Description |
|:----------|:-----|:------------|
| orderNo | string | Platform order number |
| tradeNo | string | Platform trade number |
| outTradeNo | string | Merchant order number |
| agreementNo | string | Platform agreement number |
| eventType | string | Event type: `PAY` |
| orderType | string | Order type: `PAY` |
| status | string | Transaction status: `SUCCESS` / `FAILED` |
| amount | object | Amount object |
| amount.total | string | Amount (minimum unit) |
| amount.currency | string | Currency code |
| amount.currency_type | string | Currency type |
| payTime | string | Payment time (on success) |
| failureReason | string | Failure reason (on failure) |

### Example (Success)

```json
{
  "notifyId": "NOTIFY202601070003",
  "notifyType": "TRANSACTION_RESULT",
  "notifyTime": "2026-01-07T10:30:05+08:00",
  "merchantId": "M123456789",
  "data": {
    "orderNo": "ORD202601070001",
    "tradeNo": "PAY202601070001",
    "outTradeNo": "ORDER20260107001",
    "agreementNo": "AGR202601070001",
    "eventType": "PAY",
    "orderType": "PAY",
    "status": "SUCCESS",
    "amount": {
      "total": "2350",
      "currency": "USDT",
      "currency_type": "CRYPTO"
    },
    "payTime": "2026-01-07 10:30:00"
  },
  "sign": "Base64 encoded signature",
  "signType": "RSA2"
}
```

### Example (Failure)

```json
{
  "notifyId": "NOTIFY202601070004",
  "notifyType": "TRANSACTION_RESULT",
  "notifyTime": "2026-01-07T10:30:05+08:00",
  "merchantId": "M123456789",
  "data": {
    "orderNo": "ORD202601070002",
    "tradeNo": "PAY202601070002",
    "outTradeNo": "ORDER20260107002",
    "agreementNo": "AGR202601070001",
    "eventType": "PAY",
    "orderType": "PAY",
    "status": "FAILED",
    "amount": {
      "total": "5000",
      "currency": "USDT",
      "currency_type": "CRYPTO"
    },
    "failureReason": "BALANCE_NOT_ENOUGH"
  },
  "sign": "Base64 encoded signature",
  "signType": "RSA2"
}
```

---

## Refund Result Notification

### data Fields

| Parameter | Type | Description |
|:----------|:-----|:------------|
| orderNo | string | Platform order number |
| refundNo | string | Platform refund number |
| outRefundNo | string | Merchant refund number |
| tradeNo | string | Original trade number |
| outTradeNo | string | Original merchant order number |
| agreementNo | string | Platform agreement number |
| eventType | string | Event type: `REFUND` |
| orderType | string | Order type: `REFUND` |
| status | string | Refund status: `SUCCESS` / `FAILED` |
| refund_amount | object | Refund amount object |
| refundTime | string | Refund time (on success) |
| failureReason | string | Failure reason (on failure) |

### Example (Success)

```json
{
  "notifyId": "NOTIFY202601070005",
  "notifyType": "TRANSACTION_RESULT",
  "notifyTime": "2026-01-07T11:30:05+08:00",
  "merchantId": "M123456789",
  "data": {
    "orderNo": "ORD202601070003",
    "refundNo": "RF202601070001",
    "outRefundNo": "REFUND20260107001",
    "tradeNo": "PAY202601070001",
    "outTradeNo": "ORDER20260107001",
    "agreementNo": "AGR202601070001",
    "eventType": "REFUND",
    "orderType": "REFUND",
    "status": "SUCCESS",
    "refund_amount": {
      "total": "2350",
      "currency": "USDT",
      "currency_type": "CRYPTO"
    },
    "refundTime": "2026-01-07 11:30:00"
  },
  "sign": "Base64 encoded signature",
  "signType": "RSA2"
}
```

### Example (Failure)

```json
{
  "notifyId": "NOTIFY202601070010",
  "notifyType": "TRANSACTION_RESULT",
  "notifyTime": "2026-01-07T11:30:05+08:00",
  "merchantId": "M123456789",
  "data": {
    "orderNo": "ORD202601070004",
    "refundNo": "RF202601070002",
    "outRefundNo": "REFUND20260107002",
    "tradeNo": "PAY202601070001",
    "outTradeNo": "ORDER20260107001",
    "agreementNo": "AGR202601070001",
    "eventType": "REFUND",
    "orderType": "REFUND",
    "status": "FAILED",
    "refund_amount": {
      "total": "2350",
      "currency": "USDT",
      "currency_type": "CRYPTO"
    },
    "failureReason": "BALANCE_NOT_ENOUGH"
  },
  "sign": "Base64 encoded signature",
  "signType": "RSA2"
}
```

---

## Agreement Unsign Notification

### data Fields

| Parameter | Type | Description |
|:----------|:-----|:------------|
| agreementNo | string | Platform agreement number |
| externalAgreementNo | string | Merchant agreement number |
| eventType | string | Event type: `UNSIGNED` |
| status | string | Agreement status: `UNSIGNED` |
| unsignType | string | Unsign type: `USER` / `MERCHANT` / `EXPIRED` / `SYSTEM` |
| unsignTime | string | Unsign time |

### Example

```json
{
  "notifyId": "NOTIFY202601070006",
  "notifyType": "AGREEMENT_STATUS",
  "notifyTime": "2026-01-07T15:30:05+08:00",
  "merchantId": "M123456789",
  "data": {
    "agreementNo": "AGR202601070001",
    "externalAgreementNo": "MERCHANT_AGR_001",
    "eventType": "UNSIGNED",
    "status": "UNSIGNED",
    "unsignType": "USER",
    "unsignTime": "2026-01-07 15:30:00"
  },
  "sign": "Base64 encoded signature",
  "signType": "RSA2"
}
```

---

## Agreement Suspend Notification

### data Fields

| Parameter | Type | Description |
|:----------|:-----|:------------|
| agreementNo | string | Platform agreement number |
| externalAgreementNo | string | Merchant agreement number |
| eventType | string | Event type: `SUSPENDED` |
| status | string | Agreement status: `SUSPENDED` |
| suspendReason | string | Suspend reason: `RISK` / `ABNORMAL` / `MANUAL` |
| suspendTime | string | Suspend time |

### Example

```json
{
  "notifyId": "NOTIFY202601070007",
  "notifyType": "AGREEMENT_STATUS",
  "notifyTime": "2026-01-07T16:30:05+08:00",
  "merchantId": "M123456789",
  "data": {
    "agreementNo": "AGR202601070001",
    "externalAgreementNo": "MERCHANT_AGR_001",
    "eventType": "SUSPENDED",
    "status": "SUSPENDED",
    "suspendReason": "RISK",
    "suspendTime": "2026-01-07 16:30:00"
  },
  "sign": "Base64 encoded signature",
  "signType": "RSA2"
}
```

---

## Agreement Resume Notification

### data Fields

| Parameter | Type | Description |
|:----------|:-----|:------------|
| agreementNo | string | Platform agreement number |
| externalAgreementNo | string | Merchant agreement number |
| eventType | string | Event type: `SIGNED` |
| status | string | Agreement status: `SIGNED` |
| resumeTime | string | Resume time |

### Example

```json
{
  "notifyId": "NOTIFY202601070008",
  "notifyType": "AGREEMENT_STATUS",
  "notifyTime": "2026-01-07T18:30:05+08:00",
  "merchantId": "M123456789",
  "data": {
    "agreementNo": "AGR202601070001",
    "externalAgreementNo": "MERCHANT_AGR_001",
    "eventType": "SIGNED",
    "status": "SIGNED",
    "resumeTime": "2026-01-07 18:30:00"
  },
  "sign": "Base64 encoded signature",
  "signType": "RSA2"
}
```

---

## Sign Timeout Notification

When sign link/QR code expires, platform pushes sign timeout notification to merchant.

### data Fields

| Parameter | Type | Description |
|:----------|:-----|:------------|
| agreementNo | string | Platform agreement number |
| externalAgreementNo | string | Merchant agreement number |
| agreementType | string | Sign type: `CYCLE` / `SINGLE` |
| eventType | string | Event type: `TIMEOUT` |
| status | string | Agreement status: `TIMEOUT` |
| userId | string | Platform user ID |
| merchantUserId | string | Merchant-side user ID |
| sceneCode | string | Scene code |
| timeoutTime | string | Timeout time |

### Example

```json
{
  "notifyId": "NOTIFY202601070011",
  "notifyType": "AGREEMENT_STATUS",
  "notifyTime": "2026-01-07T11:00:05+08:00",
  "merchantId": "M123456789",
  "data": {
    "agreementNo": "AGR202601070003",
    "externalAgreementNo": "MERCHANT_AGR_003",
    "agreementType": "CYCLE",
    "eventType": "TIMEOUT",
    "status": "TIMEOUT",
    "userId": "U_123456789",
    "merchantUserId": "merchant_user_123",
    "sceneCode": "SUBSCRIPTION",
    "timeoutTime": "2026-01-07 11:00:00"
  },
  "sign": "Base64 encoded signature",
  "signType": "RSA2"
}
```

---

## Order Timeout Notification

When deduction order times out without completion, platform pushes order timeout notification to merchant.

### data Fields

| Parameter | Type | Description |
|:----------|:-----|:------------|
| orderNo | string | Platform order number |
| tradeNo | string | Platform trade number |
| outTradeNo | string | Merchant order number |
| agreementNo | string | Platform agreement number |
| eventType | string | Event type: `PAY` |
| orderType | string | Order type: `PAY` / `REFUND` |
| status | string | Order status: `TIMEOUT` |
| userId | string | Platform user ID |
| merchantUserId | string | Merchant-side user ID |
| amount | object | Amount object |
| amount.total | string | Amount (minimum unit) |
| amount.currency | string | Currency code |
| amount.currency_type | string | Currency type |
| failureReason | string | Failure reason |
| timeoutTime | string | Timeout time |

### Example

```json
{
  "notifyId": "NOTIFY202601070012",
  "notifyType": "TRANSACTION_RESULT",
  "notifyTime": "2026-01-07T12:00:05+08:00",
  "merchantId": "M123456789",
  "data": {
    "orderNo": "ORD202601070010",
    "tradeNo": "PAY202601070010",
    "outTradeNo": "ORDER20260107010",
    "agreementNo": "AGR202601070001",
    "eventType": "PAY",
    "orderType": "PAY",
    "status": "TIMEOUT",
    "userId": "U_123456789",
    "merchantUserId": "merchant_user_123",
    "amount": {
      "total": "5000",
      "currency": "USDT",
      "currency_type": "CRYPTO"
    },
    "failureReason": "ORDER_TIMEOUT",
    "timeoutTime": "2026-01-07 12:00:00"
  },
  "sign": "Base64 encoded signature",
  "signType": "RSA2"
}
```

---

## Webhook Handling

### Request Headers

| Parameter | Type | Description |
|:----------|:-----|:------------|
| X-Timestamp | string | Notification timestamp (milliseconds) |
| X-Signature | string | Notification signature |
| X-Nonce | string | Random string |
| Content-Type | string | `application/json` |

### Retry Mechanism

| Configuration | Value |
|:--------------|:------|
| Retry count | Maximum 5 retries |
| Retry interval | 15s, 30s, 1min, 5min, 30min |
| Success indicator | HTTP 200 with body `success` |
| Timeout | 10 seconds per request |

### Merchant Response

Return plain text `success` (case insensitive) with HTTP 200:

```
success
```

### Handling Code Example (Java)

```java
@RestController
@RequestMapping("/webhook")
public class WebhookController {

    @PostMapping("/agreement")
    public ResponseEntity<String> handleWebhook(
            @RequestHeader("X-Timestamp") String timestamp,
            @RequestBody String body) {

        JSONObject notify = JSON.parseObject(body);
        String sign = notify.getString("sign");

        // 1. Remove sign and signType for verification
        notify.remove("sign");
        notify.remove("signType");
        String contentToVerify = notify.toJSONString();

        // 2. Verify signature
        if (!verifySignature(contentToVerify, sign)) {
            return ResponseEntity.status(400).body("signature_error");
        }

        // 3. Check timestamp (prevent replay)
        if (Math.abs(System.currentTimeMillis() - Long.parseLong(timestamp)) > 5 * 60 * 1000) {
            return ResponseEntity.status(400).body("timestamp_expired");
        }

        // 4. Idempotency check
        String notifyId = notify.getString("notifyId");
        if (isProcessed(notifyId)) {
            return ResponseEntity.ok("success");
        }

        // 5. Process business by notifyType and eventType
        String notifyType = notify.getString("notifyType");
        JSONObject data = notify.getJSONObject("data");
        String eventType = data.getString("eventType");

        if ("AGREEMENT_STATUS".equals(notifyType)) {
            // Handle agreement status changes
            switch (eventType) {
                case "SIGNED":
                    handleSignedNotify(data);
                    break;
                case "UNSIGNED":
                    handleUnsignNotify(data);
                    break;
                case "SUSPENDED":
                    handleSuspendNotify(data);
                    break;
                case "TIMEOUT":
                    handleTimeoutNotify(data);
                    break;
            }
        } else if ("TRANSACTION_RESULT".equals(notifyType)) {
            // Handle transaction results
            String orderType = data.getString("orderType");
            if ("PAY".equals(orderType)) {
                handlePayNotify(data);
            } else if ("REFUND".equals(orderType)) {
                handleRefundNotify(data);
            }
        }

        markAsProcessed(notifyId);
        return ResponseEntity.ok("success");
    }
}
```

---

## Notes

1. **Deduplication**: Use `notifyId` to prevent duplicate processing
2. **Signature Verification**: Always verify signature before processing
3. **Idempotency**: Same notification may be sent multiple times; ensure idempotent handling
4. **Response Quickly**: Return `success` immediately; process business asynchronously if needed
5. **Event Type Check**: Use `eventType` and `orderType` to distinguish specific events within each notification category
